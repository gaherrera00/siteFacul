<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Produto - Doces JAE</title>
    <link rel="icon" href="./img/aba.jpeg" type="image/x-icon" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <div class="logo">
        <img src="./img/logo.png" alt="Logo" />
      </div>
      <nav>
        <ul>
          <li><a href="./index.html">Home</a></li>
          <li><a href="./produtos.html">Produtos</a></li>
          <li><a href="./contatos.html">Contato</a></li>
          <li><a href="./encomendas.html">Encomendas</a></li>
        </ul>
      </nav>
    </header>

    <h2>Encomendas</h2>
    <div class="buscar">
      <h4>Buscar clientes:</h4>
      <input
        type="search"
        id="buscar"
        name="buscar"
        placeholder="Nome do cliente"
      />
    </div>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Valor unitario</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody class="tabelaClientes">
        <tr class="cliente">
          <td class="nome">Carolina</td>
          <td class="produtoCliente">Pirulitos coloridos (10 unidades)</td>
          <td class="qtde">2</td>
          <td class="unitario">50</td>
          <td class="total"></td>
        </tr>
        <tr class="cliente">
          <td class="nome">Margarete</td>
          <td class="produtoCliente">Combo Brigadeiros (6 unidades)</td>
          <td class="qtde">2</td>
          <td class="unitario">30</td>
          <td class="total"></td>
        </tr>
        <tr class="cliente">
          <td class="nome">Daniele</td>
          <td class="produtoCliente">Fatia de bolo (Creme)</td>
          <td class="qtde">1</td>
          <td class="unitario">25</td>
          <td class="total"></td>
        </tr>
        <tr class="cliente">
          <td class="nome">Daniele</td>
          <td class="produtoCliente">Fatia de bolo (Chocolate)</td>
          <td class="qtde">0</td>
          <td class="unitario">25</td>
          <td class="total"></td>
        </tr>
      </tbody>
    </table>

    <section class="form-contato">
      <form action="#" method="POST">
        <fieldset>
          <legend>Fazer Pedido</legend>

          <label for="nome">Nome do Cliente:</label>
          <input type="text" id="nome" name="nome" required />

          <label for="produto">Produto:</label>
          <select id="produto" name="produto" required>
            <option value="">Selecione um produto</option>
            <option value="Brigadeiro Gourmet">Brigadeiro Gourmet</option>
            <option value="Bolo de Morango">Bolo de Morango</option>
            <option value="Doce Vegano">Doce Vegano</option>
            <option value="Caixa Personalizada">Caixa Personalizada</option>
            <option value="Pudim de Leite">Pudim de Leite</option>
            <option value="Trufa de Maracujá">Trufa de Maracujá</option>
            <option value="Mini Cheesecake">Mini Cheesecake</option>
            <option value="Cookies com Gotas de Chocolate">
              Cookies com Gotas de Chocolate
            </option>
            <option value="Bombom de Uva">Bombom de Uva</option>
            <option value="Doce de Leite com Nozes">
              Doce de Leite com Nozes
            </option>
            <option value="Rocambole de Chocolate">
              Rocambole de Chocolate
            </option>
            <option value="Torta Banoffee">Torta Banoffee</option>
          </select>

          <label for="quantidade">Quantidade:</label>
          <input
            type="number"
            id="quantidade"
            name="quantidade"
            min="1"
            required
          />

          <label for="valor">Valor Unitário (R$):</label>
          <input
            type="number"
            id="valor"
            name="valor"
            min="0.01"
            step="0.01"
            required
          />

          <input type="submit" value="Enviar Pedido" />
        </fieldset>
      </form>
    </section>

    <footer class="footer">
      <div class="footer-logo">
        <img src="./img/logo.png" alt="Logo Doces JAE" />
      </div>
      <div class="footer-links">
        <p>© 2025 Doces JAE - Todos os direitos reservados</p>
      </div>
    </footer>

    <script>
      // Função para formatar valor em real
      function formatarValor(valor) {
        return valor.toLocaleString("pt-br", {
          style: "currency",
          currency: "BRL",
        });
      }

      // Adiciona item à tabela
      function addItem() {
        const nome = document.getElementById("nome").value.trim();
        const produto = document.getElementById("produto").value;
        const quantidade = Number(document.getElementById("quantidade").value);
        const valorUnitario = Number(document.getElementById("valor").value);

        const tbody = document.querySelector(".tabelaClientes");

        const tr = document.createElement("tr");
        tr.classList.add("cliente");

        tr.innerHTML = `
        <td class="nome">${nome}</td>
        <td class="produtoCliente">${produto}</td>
        <td class="qtde">${quantidade}</td>
        <td class="unitario">${formatarValor(valorUnitario)}</td>
        <td class="total">${formatarValor(quantidade * valorUnitario)}</td>
      `;

        tbody.appendChild(tr);

        document.querySelector("form").reset();
      }

      // Função de pesquisa de cliente
      document.querySelector("#buscar").addEventListener("input", function () {
        const linhas = document.querySelectorAll(".cliente");

        linhas.forEach((linha) => {
          const nome = linha.querySelector(".nome").textContent.toLowerCase();
          if (nome.includes(this.value.toLowerCase())) {
            linha.classList.remove("invisivel");
          } else {
            linha.classList.add("invisivel");
          }
        });
      });

      // Remover item da tabela com duplo clique
      document
        .querySelector(".tabelaClientes")
        .addEventListener("dblclick", function (event) {
          const linha = event.target.closest("tr");
          if (confirm("Tem certeza que deseja excluir essa linha?")) {
            linha.remove();
          }
        });

      // Evento para envio do formulário
      document
        .querySelector("form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          addItem();
        });

      // Calcular total ao carregar
      function calcularTotal() {
        const linhas = document.querySelectorAll(".cliente");

        linhas.forEach((linha) => {
          let quantidade = Number(linha.querySelector(".qtde").textContent);
          let valor = linha.querySelector(".unitario").textContent;

          // Remover formatação
          valor = Number(valor.replace(/[^\d,]/g, "").replace(",", "."));

          if (quantidade > 0 && !isNaN(valor)) {
            const total = quantidade * valor;
            linha.querySelector(".unitario").textContent = formatarValor(valor);
            linha.querySelector(".total").textContent = formatarValor(total);
          } else {
            linha.querySelector(".total").textContent = "XXX";
          }
        });
      }

      calcularTotal();
    </script>
  </body>
</html>
